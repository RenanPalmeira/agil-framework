/* Boss
 * v0.1
 * Author: Renan & Wellington
**/

var boss = {
	about: {
		version: 0.1,
		author: "Tecfalcon",
		created: "set 2015"
	},
	title: function(txt) {
		var el = boss.get(".title-project");
		boss.removeClass(el, "hidden");
		boss.get(".title-project").innerHTML = " &#45; " + txt;
		document.title = 'Tecfalcon - ' + (txt.charAt(0).toUpperCase() + txt.slice(1));
	},
	get: function(seletor,seletor_aux){
		if(typeof(seletor)=="string" && seletor.indexOf("#")==0 && seletor.indexOf(" ")==-1) {
			return document.getElementById(seletor.substr(1))
		}
		if(typeof(document.querySelector)!="undefined" && document.querySelector) {
			return document.querySelector(seletor)
		}
		else { 
			var els=document.querySelectorAll(seletor);
			if(els && els.length>0){
				return els[0];
			}
			else { 
				return null;
			}
		}
	},
	isMobile: function (){
		if(navigator.userAgent.match(/Mobile|Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i)){
			return true;
		}
		else{
			return false;
		}
	},
	toggleClass: function(el, className ,check){
		if(!el)
			return false;
		
		if(typeof(el) == "string")
			el = document.getElementById(el);

		var oldClassName = el.className;

		if(!oldClassName){
			oldClassName = "";
		}
		if(typeof(check) == "undefined" || check == null)
			check = (oldClassName.indexOf(className) == -1);
		if(check){
			if(oldClassName.indexOf(className) == -1)
				el.className = oldClassName + " " + className;
		}
		else{
			if(oldClassName.indexOf(className) > -1)
				el.className = oldClassName.replace(className,"");
		}
		el.className = el.className.replace("  "," ");
	},
	addClass: function(el,className){
		return this.toggleClass(el, className, true);
	},
	removeClass: function(el,className){
		return this.toggleClass(el, className, false);
	},
	hasClass: function(el, className){
		el = typeof(el) == "string" ? document.getElementById(el) : el;

		if(el.className.indexOf(className) >= 0){
			var classes = el.className.split(" ");
	 		
	 		for(var i in classes){
				if(classes[i] == className)
					return true;
			}
		}
		return false;
	},
	toArray: function(obj){
		var aux = new Array();
	
		if(Object(obj.constructor).prototype.toString()=="[object Object]" || typeof obj=="object"){
			aux = [].slice.call(obj);
		}
		else{
			for(var i = 0, a = []; i < obj.length; i++){
				aux.push(obj[i]);
			}
		}
		return aux;
	},
	type: function(obj){
		if(typeof obj == "undefined")
			return "undefined";
		if(obj == null)
			return "null";
		
		return Object.prototype.toString.call(obj).match(/^\[object\s(.*)\]$/)[1].toLowerCase();
	},
	popup: function(title, content) {
		var popup = $("#popup");
		if(title)
			$("#popup #popup-title").html(title);

		if(content)
			$("#popup #popup-content").html(content);
		else
			$("#popup #popup-content").html('');
		popup.toggleClass("active");
	},
	reload: function(page, callback) {
		jQuery.ajax({
			type: 'GET',
			url: page,
			timeout: 2000,
			success: function(data) {
				if(callback)
					callback(data);
				var lisp = function(){
					boss.reload(page, callback);
				};
				var cronos = setTimeout(lisp, 1000);
			},
			error: function (XMLHttpRequest, textStatus, errorThrown) {
				console.log(errorThrown);
			}
		});
	},
	ajax: {
		load: function(page, load_place, classe) {
			if (page && load_place) {
				jQuery.ajax({
					url: page,
					success: function(data){
						$(load_place).html(data);
						return true;
			    	}
			    });
			}
			if(classe){
				$(load_place).addClass(classe);
			}
			return undefined;
		},
		post: function(page, info, callback){
			jQuery.ajax({
				type: 'POST',
				url: page,
				data: info,
				success:function(data){
					if(callback)
						callback(data);

					return data;
				},
				error:function(err){
					if(callback)
						callback(null, err);

					return err;
				},
				cache:false
            });
		}	
	},
	bookmark: {
		get: function(key){
			var cookies = document.cookie;
			var prefix = key + "=";
			var begin = cookies.indexOf("; " + prefix);

			if (begin == -1) {
				begin = cookies.indexOf(prefix);
				if (begin != 0) 
					return null;
			} 
			else 
				begin += 2;

			var end = cookies.indexOf(";", begin);

			if (end == -1) 
				end = cookies.length;
			return unescape(cookies.substring(begin + prefix.length, end));
		},
		set: function(key, value, escaped){
			if(escaped==null)
				value = escape(value);
			var cookie = key + "=" + value;
        	document.cookie = cookie;
		},
		remove: function(key) {
			document.cookie = key + '=; expires=Thu, 05 Jan 1000 00:00:01 GMT;';
		}
	},
	oauth: function(url){
		var newWindow = window.open(url,'window', 'width=500px, height=400px, top=150px, left=250');
		
		if (window.focus) {
			newWindow.focus();
		}
	},
	modalWindow: function(datas){
		var fields_single = ['pk', 'pk2', 'title', 'content', 'members'];

		$('#modal_window').addClass('active');

		$("#window_members").empty();
		if(datas['members'].length>0){
			$("#window_members").append("<b>Membros:</b><br/>");
			$.each(datas['members'], function(index, value) {
				$("#window_members").append("<p class='btn btn-xs btn-disabled' style='margin-left:2px; cursor: default!important; opacity:1;'>"+value+"</p>");
			});
		}

		$("#window_items").empty();
		if(datas['items'].length>0){
			$("#window_items").append("<b>Items:</b><br/>");
			$.each(datas['items'], function(index, value) {
				$("#window_items").append("<li><label><input type='checkbox' class='checkbox' onclick='boss.progress(\"#progress-bar\")'>&nbsp;&nbsp;&nbsp;"+value+"</label></li>");
			});
		}

		$("#window_title").empty();
		$("#window_title").append("<p>"+datas['title']+"</p>");

		$("#window_content").empty();
		$("#window_content").append("<p class='font-open-sans text-gray' style='word-wrap: break-word;'>"+datas['content']+"</p>");


		$("#window_check").on('click', function(e){
			$('#modal_window').removeClass("active");
		});
		$("#window_move").on('click', function(e){
			$('#modal_window').removeClass("active");
			
			boss.ajax.load('/app/task/form_move/?pk='+datas['pk']+"&pk2="+datas['pk2'], '#modal_dialog', 'active');
		});
		$("#window_add_members").on('click', function(e){
			$('#modal_window').removeClass("active");

			boss.removeClass('modal_window', 'active');
			boss.ajax.load('/app/task/form_create_item_member/?pk='+datas['pk'], '#modal_dialog', 'active');
		});
		$("#window_add_item").on('click', function(e){
			$('#modal_window').removeClass("active");

			boss.removeClass('modal_window', 'active');
			boss.ajax.load('/app/task/form_create_subitem/?pk='+datas['pk'], '#modal_dialog', 'active');
		});
		$("#window_edit").on('click', function(e){
			$('#modal_window').removeClass("active");
			
			boss.ajax.load('/app/task/form_edit_item/?pk='+datas['pk'], '#modal_dialog', 'active');
		});
	},
	progress: function(bar){
		
		var checked = $("input:checked").length;
		var count = $("input[type='checkbox']").length>0 ? $("input[type='checkbox']").length : 0;
		var percentage = parseInt(((checked / count) * 100), 10);
		if(percentage){
			$(bar).css({
				width: percentage+"%"
			});
			$(bar).text(percentage + "%");
		}
		else{
			$(bar).css({
				width: 0+"%"
			});
			$(bar).text('');
		}
	}
};

window.onkeydown = function(e) {
	if(e.which==27) {
		boss.bookmark.remove('comment_loadplace');
		if($('#modal_dialog').attr("class").indexOf("active")>-1)
			$('#modal_dialog').removeClass("active");
		if($('#modal_dialog').attr("class").indexOf("active-lg")>-1)
			$('#modal_dialog').removeClass("active-lg");
		if($('#popup').attr("class").indexOf("active")>-1)
			$('#popup').removeClass("active");
		if($('#notify-box').attr("class").indexOf("hidden")==-1)
			$('#notify-box').addClass("hidden");
		if($('#modal_window').attr("class").indexOf("active")>-1)
			$('#modal_window').removeClass("active");
		
		var els = $(".card-content-hidden");
			els = [].slice.call(els)
		
		els.forEach(function (el){
			if(el.className.indexOf("active")>-1)
				el.classList.remove("active");
		});
	}
}
/* Boss
 * v0.1
 * Author: Renan & Wellington

var boss = {
	about: {
		version: 0.1,
		author: "Tecfalcon",
		created: "set 2015"
	},
	title: function(txt) {
		var el = boss.get(".title-project");
		boss.removeClass(el, "hidden");
		boss.get(".title-project").innerHTML = " &#45; " + txt;
		document.title = 'Tecfalcon - ' + (txt.charAt(0).toUpperCase() + txt.slice(1));
	},
	get: function(seletor,seletor_aux){
		if(typeof(seletor)=="string" && seletor.indexOf("#")==0 && seletor.indexOf(" ")==-1) {
			return document.getElementById(seletor.substr(1))
		}
		if(typeof(document.querySelector)!="undefined" && document.querySelector) {
			return document.querySelector(seletor)
		}
		else { 
			var els=document.querySelectorAll(seletor);
			if(els && els.length>0){
				return els[0];
			}
			else { 
				return null;
			}
		}
	},
	isMobile: function (){
		if(navigator.userAgent.match(/Mobile|Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i)){
			return true;
		}
		else{
			return false;
		}
	},
	toggleClass: function(el, className ,check){
		if(!el)
			return false;
		
		if(typeof(el) == "string")
			el = document.getElementById(el);

		var oldClassName = el.className;

		if(!oldClassName){
			oldClassName = "";
		}
		if(typeof(check) == "undefined" || check == null)
			check = (oldClassName.indexOf(className) == -1);
		if(check){
			if(oldClassName.indexOf(className) == -1)
				el.className = oldClassName + " " + className;
		}
		else{
			if(oldClassName.indexOf(className) > -1)
				el.className = oldClassName.replace(className,"");
		}
		el.className = el.className.replace("  "," ");
	},
	addClass: function(el,className){
		return this.toggleClass(el, className, true);
	},
	removeClass: function(el,className){
		return this.toggleClass(el, className, false);
	},
	hasClass: function(el, className){
		el = typeof(el) == "string" ? document.getElementById(el) : el;

		if(el.className.indexOf(className) >= 0){
			var classes = el.className.split(" ");
	 		
	 		for(var i in classes){
				if(classes[i] == className)
					return true;
			}
		}
		return false;
	},
	toArray: function(obj){
		var aux = new Array();
	
		if(Object(obj.constructor).prototype.toString()=="[object Object]" || typeof obj=="object"){
			aux = [].slice.call(obj);
		}
		else{
			for(var i = 0, a = []; i < obj.length; i++){
				aux.push(obj[i]);
			}
		}
		return aux;
	},
	type: function(obj){
		if(typeof obj == "undefined")
			return "undefined";
		if(obj == null)
			return "null";
		
		return Object.prototype.toString.call(obj).match(/^\[object\s(.*)\]$/)[1].toLowerCase();
	},
	popup: function(title, content) {
		var popup = $("#popup");
		if(title)
			$("#popup #popup-title").html(title);

		if(content)
			$("#popup #popup-content").html(content);

		if(popup.attr("class").indexOf("active")==-1)
			popup.addClass("active")
		else
			popup.removeClass("active")
	},
	reload: function(page, callback) {
		jQuery.ajax({
			type: 'GET',
			url: page,
			timeout: 2000,
			success: function(data) {
				if(callback)
					callback(data);
				var lisp = function(){
					boss.reload(page, callback);
				};
				var cronos = setTimeout(lisp, 1000);
			},
			error: function (XMLHttpRequest, textStatus, errorThrown) {
				$("#notice_div").html('Timeout contacting server..');
				window.setTimeout(update, 60000);
			}
		});
	},
	ajax: {
		load: function(page, load_place, classe) {
			if (page && load_place) {
				jQuery.ajax({
					url: page,
					success: function(data){
			        	$(load_place).html(data);
						return true;
			    	}
			    });
			}
			if(classe){
				$(load_place).addClass(classe);
			}
			return undefined;
		}	
	},
	bookmark: {
		get: function(key){
			var cookies = document.cookie;
			var prefix = key + "=";
			var begin = cookies.indexOf("; " + prefix);

			if (begin == -1) {
				begin = cookies.indexOf(prefix);
				if (begin != 0) 
					return null;
			} 
			else 
				begin += 2;

			var end = cookies.indexOf(";", begin);

			if (end == -1) 
				end = cookies.length;
			return unescape(cookies.substring(begin + prefix.length, end));
		},
		set: function(key, value){
			var cookie = key + "=" + escape(value);
        	document.cookie = cookie;
		}
	},
	oauth: function(url){
		var newWindow = window.open(url,'window', 'width=500px, height=400px, top=150px, left=250');
		
		if (window.focus) {
			newWindow.focus();
		}
	},
	modalWindow: function(datas){
		var fields_single = ['title', 'content'];
		var fields_multiple = ['members'];

		for(var info in datas){			
			$('#modal_window').addClass('active');

			if(boss.type(datas[info]) == 'array'){
				
				var index = fields_multiple.indexOf(info);
				if (index >= 0){
					if(info == fields_multiple[0]){
						$("#window_"+info).empty();
						$.each(datas[info], function(index, value) {
							$("#window_"+info).append("<p class='badge' style='margin-left:2px;'>"+value+"</p>");
						});
					}
					if(info == fields_multiple[1]){
						$("#window_"+info).empty();
						$.each(datas[info], function(index, value) {
							$("#window_"+info).append("<p>"+value+"</p>");
						});
					}
				}
			}
			else{
				var index = fields_single.indexOf(info);
				if (index >= 0){
					$("#window_"+info).empty();
					if(info == fields_single[index]){
						$("#window_"+info).html(datas[info]);
					}
				}
			}
		}
	}
};

window.onkeydown = function(e) {
	if(e.which==27) {
		if($('#modal_dialog').attr("class").indexOf("active")>-1)
			$('#modal_dialog').removeClass("active");
		if($('#modal_dialog').attr("class").indexOf("active-lg")>-1)
			$('#modal_dialog').removeClass("active-lg");
		if($('#popup').attr("class").indexOf("active")>-1)
			$('#popup').removeClass("active");
		if($('#notify-box').attr("class").indexOf("hidden")==-1)
			$('#notify-box').addClass("hidden");
	}
}**/
